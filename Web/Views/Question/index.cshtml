@{
    ViewBag.Title = "index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section stylesheet{
    <link href="@Url.Content("~/content/summernote/summernote.css")" rel="stylesheet" type="text/css" />
}
@section head_scripts{
    <script src="@Url.Content("~/content/summernote/summernote.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/content/summernote/load-image.all.min.js")" type="text/javascript"></script>
}

<div class="txt-summernote"></div>

<script type="text/javascript">
    $(document).ready(function () {
        //$('.txt-summernote').summernote({
        //    onImageUpload: function (files, editor, welEditable) {
        //        //sendFile(files[0], editor, welEditable);
        //        console.log(files);
        //        console.log(editor);
        //        console.log(welEditable);
        //    }
        //});

        convert_to_summernote($('.txt-summernote'), "");
    });


    function convert_to_summernote(element, init_html) {
        element.summernote({
            minHeight: 100,
            focus: true,
            //toolbar: [
            //  //[groupname, [button list]]
            //  ['style', ['bold', 'italic', 'underline', 'clear']],
            //  ['font', ['superscript', 'subscript']],
            //  ['color', ['color']],
            //  ['para', ['ul', 'ol']],
            //  ['insert', ['picture', 'specialChar']]
            //],
            callbacks: {
                onInit: function () {
                    //console.log(init_html);
                    if (init_html) {
                        $(this).summernote("insertNode", $(init_html)[0])
                        $(this).summernote("insertText", " ");
                    }
                },

                onImageUpload: function (files, editor, welEditable) {
                    //console.log(files, editor, welEditable);
                    var file = files[0];
                    if (!file.type.match('image.*')) {
                        console.log("Error !! Not an Image !! ");
                        return;
                    }
                    var current_summernote = $(this);
                    var old_orientation = 1;
                    loadImage.parseMetaData(file, function (mydata) {
                        console.log(mydata);

                        if (mydata.exif) {
                            old_orientation = mydata.exif.get('Orientation');
                            console.log("Image Orientation : " + old_orientation);
                        }
                        var loadingImage = loadImage(file, function (img) {
                            if (img.type === "error") {
                                console.log("Error loading image ");
                            }
                            else {

                                // document.body.appendChild(img);
                                var img_tag = $('<img>', { 'src': img.toDataURL() });
                                current_summernote.summernote("insertImage", img.toDataURL(file.type, 0.9), "awesome");
                                return;
                            }
                        }, { maxWidth: 900, canvas: true, orientation: old_orientation });
                    });
                }
            }
        });
    }
</script>